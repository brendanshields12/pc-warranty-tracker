import React, { useState, useEffect } from 'react';
import { Search, Plus, Trash2, Edit2, AlertTriangle, CheckCircle, XCircle, Clock, Download, Upload, ChevronLeft, ChevronRight, Home, ArrowLeft } from 'lucide-react';

export default function PCWarrantyTracker() {
  const [pcs, setPcs] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterTeam, setFilterTeam] = useState('');
  const [editingId, setEditingId] = useState(null);
  const [filterStatus, setFilterStatus] = useState('all');
  const [currentPage, setCurrentPage] = useState(1);
  const [activeView, setActiveView] = useState('home');
  const itemsPerPage = 10;
  const [deleteConfirm, setDeleteConfirm] = useState(null);
  const [formData, setFormData] = useState({
    customerName: '',
    customerTeam: '',
    pcSerial: '',
    pcModel: '',
    purchaseDate: '',
    warrantyYears: '3'
  });

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    try {
      const result = await window.storage.get('pc-warranty-tracker-v1', true);
      if (result && result.value) {
        const loadedData = JSON.parse(result.value);
        setPcs(loadedData);
      }
    } catch (error) {
      console.error('Error loading data:', error);
    }
  };

  const saveData = async (data) => {
    try {
      await window.storage.set('pc-warranty-tracker-v1', JSON.stringify(data), true);
    } catch (error) {
      console.error('Error saving data:', error);
    }
  };

  const calculateWarrantyInfo = (purchaseDate, warrantyYears) => {
    const purchase = new Date(purchaseDate);
    const expiration = new Date(purchase);
    expiration.setFullYear(expiration.getFullYear() + parseInt(warrantyYears));
    
    const today = new Date();
    const daysRemaining = Math.ceil((expiration - today) / (1000 * 60 * 60 * 24));
    
    let status = 'good';
    if (daysRemaining < 0) status = 'expired';
    else if (daysRemaining <= 90) status = 'warning';
    
    return { expiration, daysRemaining, status };
  };

  const handleSubmit = () => {
    if (!formData.customerName || !formData.pcSerial || !formData.pcModel || !formData.purchaseDate) {
      alert('Please fill in all fields');
      return;
    }
    
    if (editingId) {
      const updated = pcs.map(pc => 
        pc.id === editingId 
          ? { ...formData, id: editingId }
          : pc
      );
      setPcs(updated);
      saveData(updated);
      setEditingId(null);
    } else {
      const newPC = {
        ...formData,
        id: Date.now().toString()
      };
      const updated = [...pcs, newPC];
      setPcs(updated);
      saveData(updated);
    }
    
    setFormData({
      customerName: '',
      customerTeam: '',
      pcSerial: '',
      pcModel: '',
      purchaseDate: '',
      warrantyYears: '3'
    });
    setActiveView('home');
  };

  const handleEdit = (pc) => {
    setFormData({
      customerName: pc.customerName,
      customerTeam: pc.customerTeam,
      pcSerial: pc.pcSerial,
      pcModel: pc.pcModel,
      purchaseDate: pc.purchaseDate,
      warrantyYears: pc.warrantyYears
    });
    setEditingId(pc.id);
    setActiveView('add');
  };

  const handleDelete = async (id) => {
    setDeleteConfirm(id);
  };

  const confirmDelete = async () => {
    if (deleteConfirm) {
      try {
        const updated = pcs.filter(pc => pc.id !== deleteConfirm);
        await saveData(updated);
        setPcs(updated);
      } catch (error) {
        console.error('Error deleting record:', error);
      }
      setDeleteConfirm(null);
    }
  };

  const handleExport = () => {
    if (pcs.length === 0) {
      alert('No data to export. Add some PC records first.');
      return;
    }
    
    const enrichedData = pcs.map(pc => {
      const warrantyInfo = calculateWarrantyInfo(pc.purchaseDate, pc.warrantyYears);
      return {
        ...pc,
        warrantyStatus: warrantyInfo.status,
        warrantyStatusColor: warrantyInfo.status === 'expired' ? 'RED' : 
                            warrantyInfo.status === 'critical' ? 'ORANGE' :
                            warrantyInfo.status === 'warning' ? 'YELLOW' : 'GREEN',
        daysRemaining: warrantyInfo.daysRemaining,
        expirationDate: warrantyInfo.expiration.toISOString().split('T')[0]
      };
    });
    
    const dataStr = JSON.stringify(enrichedData, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `pc-warranty-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  const handleImport = (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const imported = JSON.parse(e.target.result);
        if (Array.isArray(imported)) {
          setPcs(imported);
          saveData(imported);
          alert(`Successfully imported ${imported.length} records!`);
        } else {
          alert('Invalid file format. Please upload a valid backup file.');
        }
      } catch (error) {
        alert('Error reading file. Please make sure it\'s a valid JSON backup file.');
      }
    };
    reader.readAsText(file);
    event.target.value = '';
  };

  const getStatusIcon = (status) => {
    switch (status) {
      case 'expired': return <XCircle className="w-5 h-5 text-red-500" />;
      case 'warning': return <AlertTriangle className="w-5 h-5 text-yellow-500" />;
      default: return <CheckCircle className="w-5 h-5 text-green-500" />;
    }
  };

  const filteredAndSortedPCs = pcs
    .filter(pc => 
      pc.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
      (pc.customerTeam && pc.customerTeam.toLowerCase().includes(searchTerm.toLowerCase())) ||
      pc.pcSerial.toLowerCase().includes(searchTerm.toLowerCase()) ||
      pc.pcModel.toLowerCase().includes(searchTerm.toLowerCase())
    )
    .filter(pc => {
      if (filterTeam === '') return true;
      return pc.customerTeam === filterTeam;
    })
    .map(pc => ({
      ...pc,
      ...calculateWarrantyInfo(pc.purchaseDate, pc.warrantyYears)
    }))
    .filter(pc => {
      if (filterStatus === 'all') return true;
      return pc.status === filterStatus;
    })
    .sort((a, b) => {
      const statusOrder = { expired: 0, critical: 1, warning: 2, good: 3 };
      if (statusOrder[a.status] !== statusOrder[b.status]) {
        return statusOrder[a.status] - statusOrder[b.status];
      }
      return a.daysRemaining - b.daysRemaining;
    });

  const totalPages = Math.ceil(filteredAndSortedPCs.length / itemsPerPage);
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const currentPagePCs = filteredAndSortedPCs.slice(startIndex, endIndex);

  useEffect(() => {
    setCurrentPage(1);
  }, [searchTerm, filterStatus, filterTeam]);

  const stats = {
    total: pcs.length,
    expired: pcs.map(pc => ({ ...pc, ...calculateWarrantyInfo(pc.purchaseDate, pc.warrantyYears) })).filter(pc => pc.status === 'expired').length,
    warning: pcs.map(pc => ({ ...pc, ...calculateWarrantyInfo(pc.purchaseDate, pc.warrantyYears) })).filter(pc => pc.status === 'warning').length,
    good: pcs.map(pc => ({ ...pc, ...calculateWarrantyInfo(pc.purchaseDate, pc.warrantyYears) })).filter(pc => pc.status === 'good').length
  };

  if (activeView === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 p-6">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-12">
            <h1 className="text-4xl font-bold text-gray-900 mb-2">Executive Support PC Warranty Tracker</h1>
            <p className="text-gray-600">Manage and monitor warranty information for all PCs</p>
          </div>

          <div className="grid grid-cols-4 gap-4 mb-12">
            <button
              onClick={() => {
                setFilterStatus('all');
                setActiveView('search');
              }}
              className="p-6 bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-lg hover:border-blue-300 transition-all cursor-pointer"
            >
              <div className="text-3xl font-bold text-gray-900 mb-1">{stats.total}</div>
              <div className="text-sm text-gray-600">Total PCs</div>
            </button>
            <button
              onClick={() => {
                setFilterStatus('good');
                setActiveView('search');
              }}
              className="p-6 bg-green-50 rounded-xl shadow-sm border border-green-200 hover:shadow-lg hover:border-green-400 transition-all cursor-pointer"
            >
              <div className="text-3xl font-bold text-green-700 mb-1">{stats.good}</div>
              <div className="text-sm text-green-600">Good (&gt;90 days)</div>
            </button>
            <button
              onClick={() => {
                setFilterStatus('warning');
                setActiveView('search');
              }}
              className="p-6 bg-yellow-50 rounded-xl shadow-sm border border-yellow-200 hover:shadow-lg hover:border-yellow-400 transition-all cursor-pointer"
            >
              <div className="text-3xl font-bold text-yellow-700 mb-1">{stats.warning}</div>
              <div className="text-sm text-yellow-600">Warning (≤90 days)</div>
            </button>
            <button
              onClick={() => {
                setFilterStatus('expired');
                setActiveView('search');
              }}
              className="p-6 bg-red-50 rounded-xl shadow-sm border border-red-200 hover:shadow-lg hover:border-red-400 transition-all cursor-pointer"
            >
              <div className="text-3xl font-bold text-red-700 mb-1">{stats.expired}</div>
              <div className="text-sm text-red-600">Expired</div>
            </button>
          </div>

          <div className="grid grid-cols-2 gap-6 mb-8">
            <button
              onClick={() => setActiveView('add')}
              className="group bg-white rounded-xl shadow-md border-2 border-gray-200 p-8 hover:border-blue-500 hover:shadow-xl transition-all duration-300"
            >
              <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center group-hover:bg-blue-600 transition-colors duration-300">
                  <Plus className="w-8 h-8 text-blue-600 group-hover:text-white transition-colors duration-300" />
                </div>
                <h2 className="text-2xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors duration-300">Add New Record</h2>
                <p className="text-gray-600 text-center">Register a new PC and its warranty information</p>
              </div>
            </button>

            <button
              onClick={() => setActiveView('search')}
              className="group bg-white rounded-xl shadow-md border-2 border-gray-200 p-8 hover:border-green-500 hover:shadow-xl transition-all duration-300"
            >
              <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center group-hover:bg-green-600 transition-colors duration-300">
                  <Search className="w-8 h-8 text-green-600 group-hover:text-white transition-colors duration-300" />
                </div>
                <h2 className="text-2xl font-bold text-gray-900 group-hover:text-green-600 transition-colors duration-300">Search & Manage</h2>
                <p className="text-gray-600 text-center">Find, edit, and manage existing PC records</p>
              </div>
            </button>
          </div>

          <div className="flex justify-center gap-4">
            <button
              onClick={handleExport}
              className="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition flex items-center gap-2 shadow-md"
            >
              <Download className="w-5 h-5" />
              Export Data
            </button>
            <label className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center gap-2 cursor-pointer shadow-md">
              <Upload className="w-5 h-5" />
              Import Data
              <input
                type="file"
                accept=".json"
                onChange={handleImport}
                className="hidden"
              />
            </label>
          </div>
        </div>
      </div>
    );
  }

  if (activeView === 'add') {
    return (
      <div className="min-h-screen bg-gray-50 p-6">
        <div className="max-w-5xl mx-auto">
          <div className="mb-6">
            <button
              onClick={() => {
                setActiveView('home');
                setEditingId(null);
                setFormData({ customerName: '', customerTeam: '', pcSerial: '', pcModel: '', purchaseDate: '', warrantyYears: '3' });
              }}
              className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition"
            >
              <ArrowLeft className="w-5 h-5" />
              Back to Home
            </button>
          </div>

          <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-8">
            <h2 className="text-2xl font-bold mb-6">
              {editingId ? 'Edit Record' : 'Add New Record'}
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Customer Name *</label>
                <input
                  type="text"
                  placeholder="Enter customer name"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.customerName}
                  onChange={(e) => setFormData({...formData, customerName: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Customer Team</label>
                <select
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.customerTeam}
                  onChange={(e) => setFormData({...formData, customerTeam: e.target.value})}
                >
                  <option value="">Select Team</option>
                  <option value="1888 Mgmt.">1888 Mgmt.</option>
                  <option value="CCKFO">CCKFO</option>
                  <option value="Executive Assistants">Executive Assistants</option>
                  <option value="Executive Protection">Executive Protection</option>
                  <option value="Executive Support">Executive Support</option>
                  <option value="Executives">Executives</option>
                  <option value="KDT">KDT</option>
                  <option value="Koch Aviation">Koch Aviation</option>
                  <option value="Matador Security">Matador Security</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">PC Serial Number *</label>
                <input
                  type="text"
                  placeholder="Enter serial number"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.pcSerial}
                  onChange={(e) => setFormData({...formData, pcSerial: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">PC Model *</label>
                <input
                  type="text"
                  placeholder="Enter PC model"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.pcModel}
                  onChange={(e) => setFormData({...formData, pcModel: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Warranty Start Date *</label>
                <input
                  type="date"
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.purchaseDate}
                  onChange={(e) => setFormData({...formData, purchaseDate: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Warranty Lifespan</label>
                <select
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={formData.warrantyYears}
                  onChange={(e) => setFormData({...formData, warrantyYears: e.target.value})}
                >
                  <option value="1">1 Year</option>
                  <option value="2">2 Years</option>
                  <option value="3">3 Years</option>
                  <option value="4">4 Years</option>
                  <option value="5">5 Years</option>
                </select>
              </div>
            </div>
            
            <div className="mt-8 flex gap-3">
              <button
                onClick={handleSubmit}
                className="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition flex items-center justify-center gap-2 font-medium"
              >
                <Plus className="w-5 h-5" />
                {editingId ? 'Update Record' : 'Add Record'}
              </button>
              {editingId && (
                <button
                  onClick={() => {
                    setEditingId(null);
                    setFormData({ customerName: '', customerTeam: '', pcSerial: '', pcModel: '', purchaseDate: '', warrantyYears: '3' });
                  }}
                  className="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-medium"
                >
                  Cancel Editing
                </button>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      {deleteConfirm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
            <h3 className="text-lg font-semibold mb-2">Confirm Delete</h3>
            <p className="text-gray-600 mb-6">Are you sure you want to delete this PC record? This action cannot be undone.</p>
            <div className="flex gap-3 justify-end">
              <button
                onClick={() => setDeleteConfirm(null)}
                className="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
              >
                Cancel
              </button>
              <button
                onClick={confirmDelete}
                className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      )}
      <div className="max-w-7xl mx-auto">
        <div className="mb-6">
          <button
            onClick={() => setActiveView('home')}
            className="flex items-center gap-2 text-gray-600 hover:text-gray-900 transition"
          >
            <ArrowLeft className="w-5 h-5" />
            Back to Home
          </button>
        </div>

        <h1 className="text-3xl font-bold text-gray-900 mb-6">Search & Manage Records</h1>

        <div className="grid grid-cols-4 gap-4 mb-6">
          <button 
            onClick={() => setFilterStatus('all')}
            className={`p-4 rounded-lg shadow-sm border transition-all ${
              filterStatus === 'all' 
                ? 'bg-blue-50 border-blue-300 ring-2 ring-blue-500' 
                : 'bg-white border-gray-200 hover:bg-gray-50'
            }`}
          >
            <div className="text-2xl font-bold text-gray-900">{stats.total}</div>
            <div className="text-sm text-gray-600">Total PCs</div>
          </button>
          <button 
            onClick={() => setFilterStatus('good')}
            className={`p-4 rounded-lg shadow-sm border transition-all ${
              filterStatus === 'good' 
                ? 'bg-green-100 border-green-300 ring-2 ring-green-500' 
                : 'bg-green-50 border-green-200 hover:bg-green-100'
            }`}
          >
            <div className="text-2xl font-bold text-green-700">{stats.good}</div>
            <div className="text-sm text-green-600">Good (&gt;90 days)</div>
          </button>
          <button 
            onClick={() => setFilterStatus('warning')}
            className={`p-4 rounded-lg shadow-sm border transition-all ${
              filterStatus === 'warning' 
                ? 'bg-yellow-100 border-yellow-300 ring-2 ring-yellow-500' 
                : 'bg-yellow-50 border-yellow-200 hover:bg-yellow-100'
            }`}
          >
            <div className="text-2xl font-bold text-yellow-700">{stats.warning}</div>
            <div className="text-sm text-yellow-600">Warning (≤90 days)</div>
          </button>
          <button 
            onClick={() => setFilterStatus('expired')}
            className={`p-4 rounded-lg shadow-sm border transition-all ${
              filterStatus === 'expired' 
                ? 'bg-red-100 border-red-300 ring-2 ring-red-500' 
                : 'bg-red-50 border-red-200 hover:bg-red-100'
            }`}
          >
            <div className="text-2xl font-bold text-red-700">{stats.expired}</div>
            <div className="text-sm text-red-600">Expired</div>
          </button>
        </div>

        <div className="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="text"
              placeholder="Search by customer name, serial number, or model..."
              className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
          <div>
            <select
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              value={filterTeam}
              onChange={(e) => setFilterTeam(e.target.value)}
            >
              <option value="">All Customer Teams</option>
              <option value="1888 Mgmt.">1888 Mgmt.</option>
              <option value="CCKFO">CCKFO</option>
              <option value="Executive Assistants">Executive Assistants</option>
              <option value="Executive Protection">Executive Protection</option>
              <option value="Executive Support">Executive Support</option>
              <option value="Executives">Executives</option>
              <option value="KDT">KDT</option>
              <option value="Koch Aviation">Koch Aviation</option>
              <option value="Matador Security">Matador Security</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
          {filteredAndSortedPCs.length === 0 ? (
            <div className="p-12 text-center">
              <p className="text-gray-500">No PCs found matching your search criteria.</p>
            </div>
          ) : (
            <>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50 border-b border-gray-200">
                    <tr>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Customer</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Team</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Serial Number</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Model</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Start Date</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Expiration</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Days Left</th>
                      <th className="px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {currentPagePCs.map(pc => (
                      <tr key={pc.id} className={`transition ${
                        pc.status === 'expired' ? 'bg-red-50' :
                        pc.status === 'warning' ? 'bg-yellow-50' :
                        'bg-white'
                      }`}>
                        <td className="px-4 py-3 whitespace-nowrap">
                          {getStatusIcon(pc.status)}
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="font-semibold text-gray-900">{pc.customerName}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="text-gray-900">{pc.customerTeam || '-'}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="font-medium text-gray-900">{pc.pcSerial}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="text-gray-900">{pc.pcModel}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="text-gray-900">{new Date(pc.purchaseDate).toLocaleDateString()}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="text-gray-900">{pc.expiration.toLocaleDateString()}</div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className={`font-bold ${
                            pc.status === 'expired' ? 'text-red-700' :
                            pc.status === 'warning' ? 'text-yellow-700' :
                            'text-green-700'
                          }`}>
                            {pc.daysRemaining < 0 ? `Expired ${Math.abs(pc.daysRemaining)}d ago` : `${pc.daysRemaining} days`}
                          </div>
                        </td>
                        <td className="px-4 py-3 whitespace-nowrap">
                          <div className="flex gap-2">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                handleEdit(pc);
                              }}
                              className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition"
                              title="Edit"
                            >
                              <Edit2 className="w-4 h-4" />
                            </button>
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                handleDelete(pc.id);
                              }}
                              className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition"
                              title="Delete"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
              
              {totalPages > 1 && (
                <div className="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                  <div className="text-sm text-gray-700">
                    Showing <span className="font-medium">{startIndex + 1}</span> to <span className="font-medium">{Math.min(endIndex, filteredAndSortedPCs.length)}</span> of{' '}
                    <span className="font-medium">{filteredAndSortedPCs.length}</span> results
                  </div>
                  <div className="flex gap-2">
                    <button
                      onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                      disabled={currentPage === 1}
                      className={`px-3 py-2 rounded-lg border transition flex items-center gap-1 ${
                        currentPage === 1
                          ? 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed'
                          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                      }`}
                    >
                      <ChevronLeft className="w-4 h-4" />
                      Previous
                    </button>
                    
                    <div className="flex gap-1">
                      {[...Array(totalPages)].map((_, i) => {
                        const pageNum = i + 1;
                        if (
                          pageNum === 1 ||
                          pageNum === totalPages ||
                          (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)
                        ) {
                          return (
                            <button
                              key={pageNum}
                              onClick={() => setCurrentPage(pageNum)}
                              className={`px-3 py-2 rounded-lg border transition ${
                                currentPage === pageNum
                                  ? 'bg-blue-600 text-white border-blue-600'
                                  : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                              }`}
                            >
                              {pageNum}
                            </button>
                          );
                        } else if (
                          pageNum === currentPage - 2 ||
                          pageNum === currentPage + 2
                        ) {
                          return <span key={pageNum} className="px-2 py-2 text-gray-400">...</span>;
                        }
                        return null;
                      })}
                    </div>

                    <button
                      onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                      disabled={currentPage === totalPages}
                      className={`px-3 py-2 rounded-lg border transition flex items-center gap-1 ${
                        currentPage === totalPages
                          ? 'bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed'
                          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
                      }`}
                    >
                      Next
                      <ChevronRight className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              )}
            </>
          )}
        </div>
      </div>
    </div>
  );
}
